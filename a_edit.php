<?php session_start(); ?><!DOCTYPE HTML><html lang="fr">   <head>       <title>Administration - Articles</title>		<meta charset="UTF-8">		<meta name="google-site-verification" content="-CBq6SUEiAu6cE3qTAIybrBVxjZgbgeU0EgUf7Lte3c" />	   <meta name="keywords" content="Cyril, Francesconi, 95225, Supinfo, Grand Quevilly, Grand-Quevilly, CV, site personnel, Tutoriels">	   <meta name="description" content="Vous êtes dans la section administrative. ">	   <?php include("head.php"); ?>	   <script src="CharCounter/jquery.jqEasyCharCounter.min.js" type="text/javascript"></script>		<script type="text/javascript">			$(document).ready(function(){				$('#title').jqEasyCounter({					'maxChars': 60,					'maxCharsWarning': 50,					'msgFontSize': '12px',					'msgFontColor': '#000',					'msgFontFamily': 'Verdana',					'msgTextAlign': 'left',					'msgWarningColor': '#F00',					'msgAppendMethod': 'insertAfter'				});				$('#content').jqEasyCounter({					'maxChars': 1500,					'maxCharsWarning': 1400,					'msgFontSize': '12px',					'msgFontColor': '#000',					'msgFontFamily': 'Verdana',					'msgTextAlign': 'left',					'msgWarningColor': '#F00',					'msgAppendMethod': 'insertAfter'				});				$('#keyword').jqEasyCounter({					'maxChars': 60,					'maxCharsWarning': 50,					'msgFontSize': '12px',					'msgFontColor': '#000',					'msgFontFamily': 'Verdana',					'msgTextAlign': 'left',					'msgWarningColor': '#F00',					'msgAppendMethod': 'insertAfter'				});							});					</script>		<script type="text/javascript" src="ckeditor/ckeditor.js"></script>   </head>   <body>	<?php include("menu.php"); ?>	<div id="content2">		<?php			require 'config.php';			//On vérifie que la session est crée			if(isset($_SESSION['login']) AND isset($_SESSION['password']))			{				//On vérifie encore l'authentification pour éviter le cas ou quelqu'un ne crée une session anonyme				if( $_SESSION['login'] == 'cyril' AND $_SESSION['password'] == DB_PASS1)				{					//On se connecte à la base					try					{						$conn = new PDO('mysql:host='.DB_HOST .';dbname='.DB_BDD .'', ''.DB_LOGIN .'', ''.DB_PASS .'');					}					catch(Exception $e)					{						die('Erreur : ' .$e->getMessage());					}					//On recupere l'id.					$ident = $_GET['id'];					$tmp='';					//Si l'id n'est pas dans la base, on redirige vers l'édition d'une nouvelle news.					$sql = 'SELECT title AS a FROM news WHERE id ='.$ident;					foreach ($conn->query($sql) as $data) 						$tmp= $data['a'];					if($tmp == '' && $ident != -1)						echo "<script type='text/javascript'>document.location.replace('a_edit.php?id=-1');</script>";										//Si l'id est le plus grand de la base == dernier article. On affiche donc un message de sauvegarde réussite.					$sql = 'SELECT MAX(id) AS a FROM news';					foreach ($conn->query($sql) as $data) 						$tmp= $data['a'];					$affiche = 0;					if($tmp == $ident)						$affiche = 1;										//Si l'édition est demandée					if(isset($_GET['edit']))					{						$isEdit = $_GET['edit'];												if($isEdit == 'true')//Dans ce cas, on met à jour l'article deja existant.						{							$sql = $conn->prepare('UPDATE news SET title=:title, content =:contenu, keyword =:keyword WHERE id =:ident');							$sql->execute(array('title' => $_POST['title'],												'contenu' => $_POST['contenu'],												'keyword' => $_POST['keyword'],												'ident' => $ident));							echo '<p>Vos modifications ont bien été sauvegardé !</p>';						}						else//Sinon, on crée un nouvel article dans la base.						{							$sql = $conn->prepare('INSERT INTO news (title, content, keyword) VALUES (:title, :contenu,:keyword)');							$sql->execute(array('title' => $_POST['title'],												'contenu' => $_POST['contenu'],												'keyword' => $_POST['keyword']));														$sql = 'SELECT MAX(id) AS a FROM news';							foreach ($conn->query($sql) as $data) 								$ident= $data['a'];							echo "<script type='text/javascript'>document.location.replace('a_edit.php?id=".$ident."');</script>";						}					}					$req = '';					$req2 = '';					$req3 = '';							//Si on n'est pas en mode création ( != -1) on rempli le formulaire avec les données de l'article existant extraites de la base.					if( $ident != -1)					{						$sql = 'SELECT title AS a FROM news WHERE id ='.$ident;						foreach ($conn->query($sql) as $data) 							$req = $data['a'];						$sql = 'SELECT content AS a FROM news WHERE id ='.$ident;						foreach ($conn->query($sql) as $data) 							$req2 = $data['a'];						$sql = 'SELECT keyword AS a FROM news WHERE id ='.$ident;						foreach ($conn->query($sql) as $data) 							$req3 = $data['a'];					}					?>						<!--Toute cette partie concerne l'édition des news.-->										<div style="margin-left : 5px; margin-top:-10px;">							<a href="a_articles.php"><img src="images/fleche_left.png" alt="fleche"></img></a>					</div><br/>										<?php if($affiche==1)						echo '<p>Votre nouvel article a bien été sauvegardé. Il est maintenant disponible en ligne.</p>';					?>															<?php						if($ident != -1)							echo '<form id="form" name="formulaire" method="POST" action="a_edit.php?id='.$ident.'&edit=true">';						else							echo '<form id="form" name="formulaire" method="POST" action="a_edit.php?id='.$ident.'&edit=false">';					?>						<div>							<p>								<label for="title">Titre : </label><br/>								<input id="title" style="width:275px;" type="text" name="title" value="<?php echo utf8_encode($req); ?>"/>							</p>							<p style="width:834px;">								<label for="contenu">Contenu : </label><br/>								<textarea id="contenu" name="contenu"><?php echo utf8_encode($req2); ?></textarea>								<script type="text/javascript">									CKEDITOR.replace( 'contenu' );								</script>							</p>							<p>								<label for="keyword">Mots clé : </label><br/>								<input id="keyword" style="width:275px;" type="text" name="keyword" value="<?php echo utf8_encode($req3); ?>"/>							</p>							<br />							<div>								<input type="submit" value= "Envoyer"/>							</div>						</div>					</form>					<!--Fin de la zone d'édition-->					<?php				}			}								//Sinon, si le login et le mdp ne sont pas rentrés, on affiche le formulaire de connexion par défaut.			else				echo "<script type='text/javascript'>document.location.replace('a_index.php');</script>";?></div>	<?php include("footer.php"); ?>   </body></html>